<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AML Pr≈Øvodce pro Advok√°tn√≠ Praxi (Metodika 2025)</title>

    <!-- Performance: preconnect fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Font: Noto Sans for professional readability -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS (CDN). Using defer so it doesn't block parsing. -->
    <script src="https://cdn.tailwindcss.com" defer></script>

    <!-- Chart.js - deferred so it loads before DOMContentLoaded handlers run. -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        /* Chart Container Styling - MANDATORY */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 350px;
            max-height: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (max-width: 640px) {
            .chart-container {
                height: 250px;
            }
        }

        /* Card Hover Effects */
        .hover-card {
            transition: all 0.3s ease;
        }
        .hover-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Custom Active Tab State */
        .tab-active {
            border-bottom: 3px solid #1e3a8a; /* Blue-900 */
            color: #1e3a8a;
            font-weight: 700;
        }
        .tab-inactive {
            color: #6b7280;
            font-weight: 500;
        }
        .tab-inactive:hover {
            color: #374151;
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        /* Focus-visible for keyboard users */
        :focus {
            outline: 3px solid rgba(59,130,246,0.25);
            outline-offset: 2px;
        }

        /* Clickable scenario header styling */
        .scenario-toggle {
            cursor: pointer;
        }
    </style>

    <!-- NOTE: For production, prefer setting a strict Content-Security-Policy on the HTTP response (headers).
         If using a meta CSP, tailor it to allow the CDNs you require. Example (adjust before use):
         <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' https://cdn.tailwindcss.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; connect-src https:;">
    -->
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

    <!-- Header Section -->
    <header class="bg-slate-900 text-white shadow-lg" role="banner">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold tracking-tight">‚öñÔ∏è AML ≈†kolen√≠ pro Advok√°ty</h1>
                    <p class="text-slate-300 text-sm mt-1">Interaktivn√≠ pr≈Øvodce dle metodiky ƒåAK 2025 a z√°kona ƒç. 253/2008 Sb.</p>
                </div>
                <div class="mt-4 md:mt-0 text-right hidden md:block">
                    <div class="inline-block bg-amber-600 text-white text-xs font-bold px-2 py-1 rounded uppercase tracking-wider mb-1">Metodika 2025</div>
                    <div class="text-slate-400 text-xs">Aktualizov√°no pro sledovan√© ƒçinnosti</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow sticky top-0 z-50" role="navigation" aria-label="Hlavn√≠ navigace">
        <div class="container mx-auto px-4">
            <div class="flex space-x-1 md:space-x-8 overflow-x-auto pb-1" id="nav-container" role="tablist" aria-label="Sekce aplikace">
                <button onclick="switchTab('tab-prehled')" id="btn-tab-prehled" class="tab-active py-4 px-2 whitespace-nowrap focus:outline-none transition-colors" role="tab" aria-controls="tab-prehled" aria-selected="true">
                    Sledovan√© ƒåinnosti
                </button>
                <button onclick="switchTab('tab-limity')" id="btn-tab-limity" class="tab-inactive py-4 px-2 whitespace-nowrap focus:outline-none transition-colors" role="tab" aria-controls="tab-limity" aria-selected="false">
                    Finanƒçn√≠ Limity
                </button>
                <button onclick="switchTab('tab-wizard')" id="btn-tab-wizard" class="tab-inactive py-4 px-2 whitespace-nowrap focus:outline-none transition-colors" role="tab" aria-controls="tab-wizard" aria-selected="false">
                    ‚ö° Anal√Ωza Klienta (Wizard)
                </button>
                <button onclick="switchTab('tab-rizika')" id="btn-tab-rizika" class="tab-inactive py-4 px-2 whitespace-nowrap focus:outline-none transition-colors" role="tab" aria-controls="tab-rizika" aria-selected="false">
                    Rizikov√© Faktory
                </button>
                <button onclick="switchTab('tab-situace')" id="btn-tab-situace" class="tab-inactive py-4 px-2 whitespace-nowrap focus:outline-none transition-colors" role="tab" aria-controls="tab-situace" aria-selected="false">
                    Modelov√© Situace
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow container mx-auto px-4 py-8" role="main">

        <!-- TAB 1: P≈ôehled / Sledovan√© ƒåinnosti -->
        <section id="tab-prehled" class="space-y-8 animate-fade-in" tabindex="-1">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h2 class="text-2xl font-bold text-slate-800 mb-4">Kdy se advok√°t st√°v√° povinnou osobou?</h2>
                <div class="p-4 bg-blue-50 border-l-4 border-blue-600 rounded mb-6">
                    <p class="text-blue-900 text-sm">
                        <strong>Kl√≠ƒçov√Ω princip:</strong> Advok√°t nen√≠ povinnou osobou AML p≈ôi poskytov√°n√≠ ve≈°ker√Ωch slu≈æeb. Povinnosti (Identifikace a Kontrola) dopadaj√≠ pouze na tzv. 
                        <strong>SLEDOVAN√â ƒåINNOSTI</strong> (¬ß 2 odst. 1 p√≠sm. g) AML z√°kona).
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Sledovan√© ƒåinnosti -->
                    <div class="border rounded-xl p-5 bg-white hover:shadow-md transition relative overflow-hidden" aria-hidden="false">
                        <div class="absolute top-0 right-0 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-bl">AML PLAT√ç</div>
                        <h3 class="font-bold text-lg mb-3">‚úÖ Sledovan√© ƒçinnosti</h3>
                        <ul class="list-disc list-inside space-y-2 text-slate-700 text-sm">
                            <li><strong>Advok√°tn√≠ √∫schova</strong> penƒõz, cenn√Ωch pap√≠r≈Ø nebo jin√©ho majetku.</li>
                            <li>N√°kup nebo prodej <strong>nemovitosti</strong> ƒçi podniku.</li>
                            <li>Spr√°va majetku klienta (svƒõ≈ôensk√© fondy).</li>
                            <li>Zakl√°d√°n√≠, ≈ô√≠zen√≠ nebo provozov√°n√≠ obchodn√≠ch spoleƒçnost√≠.</li>
                            <li>Poskytov√°n√≠ s√≠dla (pokud je to hlavn√≠ slu≈æba).</li>
                        </ul>
                    </div>

                    <!-- Nesledovan√© ƒåinnosti -->
                    <div class="border rounded-xl p-5 bg-white hover:shadow-md transition relative overflow-hidden" aria-hidden="false">
                        <div class="absolute top-0 right-0 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-bl">AML NEPLAT√ç</div>
                        <h3 class="font-bold text-lg mb-3">üõ°Ô∏è Vy≈àat√© ƒçinnosti (Mlƒçenlivost)</h3>
                        <ul class="list-disc list-inside space-y-2 text-slate-700 text-sm">
                            <li><strong>Obhajoba</strong> v trestn√≠m ≈ô√≠zen√≠ (absolutn√≠ v√Ωjimka).</li>
                            <li>Zastupov√°n√≠ v ≈ô√≠zen√≠ p≈ôed soudy (spory).</li>
                            <li>Pr√°vn√≠ poradenstv√≠ t√Ωkaj√≠c√≠ se <strong>urƒçen√≠ pr√°vn√≠ho postaven√≠</strong> klienta.</li>
                            <li>Bƒõ≈æn√© sepisov√°n√≠ smluv bez manipulace s prost≈ôedky (pokud nejde o p≈ôevod nemovitosti/obch. pod√≠lu).</li>
                        </ul>
                    </div>
                </div>

                <!-- Process Steps -->
                <div class="mt-8">
                    <h3 class="font-bold text-slate-800 mb-4">Procesn√≠ postup u sledovan√Ωch ƒçinnost√≠</h3>
                    <div class="flex flex-col md:flex-row justify-between text-sm text-center gap-2">
                        <div class="bg-gray-100 p-3 rounded flex-1">1. P≈ôijet√≠ pokynu</div>
                        <div class="hidden md:block text-gray-400 self-center">‚ûú</div>
                        <div class="bg-blue-100 text-blue-800 font-semibold p-3 rounded flex-1">2. Posouzen√≠ (Je to sledovan√° ƒçinnost?)</div>
                        <div class="hidden md:block text-gray-400 self-center">‚ûú</div>
                        <div class="bg-indigo-100 text-indigo-800 font-semibold p-3 rounded flex-1">3. Identifikace (Kdo je klient?)</div>
                        <div class="hidden md:block text-gray-400 self-center">‚ûú</div>
                        <div class="bg-purple-100 text-purple-800 font-semibold p-3 rounded flex-1">4. Kontrola (P≈Øvod penƒõz, Sankce)</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB 2: Finanƒçn√≠ Limity -->
        <section id="tab-limity" class="hidden space-y-8 animate-fade-in" tabindex="-1">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">Finanƒçn√≠ prahy pro rok 2025</h2>
                <p class="text-slate-600 mb-6">
                    Graf zn√°zor≈àuje limity aktivuj√≠c√≠ povinnosti u <strong>sledovan√Ωch ƒçinnost√≠</strong>. U √∫schovy penƒõz je nutn√© prov√©st identifikaci <strong>v≈ædy</strong>, bez ohledu na limit.
                </p>

                <div class="flex flex-col items-center">
                    <div class="chart-container" aria-hidden="false">
                        <canvas id="limitsChart" role="img" aria-label="Graf finanƒçn√≠ch limit≈Ø"></canvas>
                    </div>
                </div>

                <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="text-2xl font-bold text-indigo-600">1 000 EUR</div>
                        <div class="text-sm font-semibold text-slate-700">P≈ô√≠le≈æitostn√Ω obchod</div>
                        <div class="text-xs text-slate-500 mt-1">Identifikace nutn√° nad tento limit (pokud nejde o √∫schovu, tam v≈ædy).</div>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="text-2xl font-bold text-indigo-600">15 000 EUR</div>
                        <div class="text-sm font-semibold text-slate-700">Povinn√° Kontrola</div>
                        <div class="text-xs text-slate-500 mt-1">Hranice pro hloubkovou kontrolu (zji≈°≈•ov√°n√≠ p≈Øvodu prost≈ôedk≈Ø).</div>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="text-2xl font-bold text-red-600">270 000 CZK</div>
                        <div class="text-sm font-semibold text-slate-700">Limit Hotovosti</div>
                        <div class="text-xs text-slate-500 mt-1">Absolutn√≠ z√°kaz p≈ôij√≠mat hotovost nad tuto ƒç√°stku.</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB 3: Anal√Ωza Klienta (Interactive Wizard) -->
        <section id="tab-wizard" class="hidden space-y-8 animate-fade-in" tabindex="-1">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Inputs Column -->
                <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-sm border border-slate-200 h-fit">
                    <h2 class="text-xl font-bold text-slate-800 mb-4 border-b pb-2">1. Parametry Slu≈æby</h2>

                    <form id="amlWizardForm" onsubmit="event.preventDefault(); calculateObligations();" novalidate>
                        <!-- Service Type (CRITICAL UPDATE) -->
                        <div class="mb-5">
                            <label for="serviceType" class="block text-sm font-bold text-slate-800 mb-2">Typ Pr√°vn√≠ Slu≈æby <span class="text-red-500">*</span></label>
                            <select id="serviceType" name="serviceType" class="w-full p-3 border border-slate-300 rounded-lg bg-blue-50 focus:ring-2 focus:ring-blue-500 text-slate-800 font-medium" aria-required="true" aria-describedby="serviceTypeHelp">
                                <optgroup label="Sledovan√© ƒçinnosti (AML se vztahuje)">
                                    <option value="uschova">Advok√°tn√≠ √∫schova (Pen√≠ze/Cenn√© pap√≠ry)</option>
                                    <option value="nemovitost">P≈ôevod nemovitosti / Obchodn√≠ho pod√≠lu</option>
                                    <option value="korporace">Zakl√°d√°n√≠/Spr√°va obchodn√≠ korporace</option>
                                    <option value="majatek">Spr√°va ciz√≠ho majetku</option>
                                </optgroup>
                                <optgroup label="Nesledovan√© ƒçinnosti (AML v√Ωjimky)">
                                    <option value="obhajoba">Obhajoba v trestn√≠m ≈ô√≠zen√≠</option>
                                    <option value="poradenstvi">Bƒõ≈æn√© pr√°vn√≠ poradenstv√≠ / Zastupov√°n√≠ v soudu</option>
                                </optgroup>
                            </select>
                            <p id="serviceTypeHelp" class="text-xs text-slate-500 mt-1">Typ slu≈æby urƒçuje, zda se v≈Øbec aplikuje AML z√°kon.</p>
                        </div>

                        <h2 class="text-xl font-bold text-slate-800 mb-4 border-b pb-2 mt-8">2. Parametry Klienta</h2>

                        <!-- Value Input -->
                        <div class="mb-5">
                            <label for="tradeValue" class="block text-sm font-semibold text-slate-700 mb-2">Hodnota obchodu (EUR)</label>
                            <input type="number" id="tradeValue" name="tradeValue" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Nap≈ô. 20000" min="0" step="0.01" inputmode="decimal" aria-describedby="tradeValueHelp tradeValueError" />
                            <p id="tradeValueHelp" class="text-xs text-slate-500 mt-1">Zadejte ƒç√°stku v eurech. Nelze zadat z√°porn√© hodnoty.</p>
                            <p id="tradeValueError" class="text-xs text-red-600 mt-1" role="alert" aria-live="polite" style="display:none;"></p>
                        </div>

                        <!-- Client Type -->
                        <div class="mb-5">
                            <label for="clientType" class="block text-sm font-semibold text-slate-700 mb-2">Typ Klienta</label>
                            <select id="clientType" name="clientType" class="w-full p-3 border border-slate-300 rounded-lg bg-white">
                                <option value="fyzicka">Fyzick√° osoba (Obƒçan)</option>
                                <option value="pravnicka">Pr√°vnick√° osoba (Firma)</option>
                                <option value="sverensky">Svƒõ≈ôensk√Ω fond / Trust</option>
                            </select>
                        </div>

                        <!-- Risk Toggles -->
                        <fieldset class="space-y-3 mb-6 bg-slate-50 p-3 rounded-lg border border-slate-100">
                            <legend class="sr-only">Rizikov√© faktory</legend>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="isPEP" class="form-checkbox h-4 w-4 text-blue-600 rounded">
                                <span class="text-sm text-slate-700">Klient je <strong>PEP</strong> (Politicky exponovan√° osoba)</span>
                            </label>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="isHighRiskCountry" class="form-checkbox h-4 w-4 text-blue-600 rounded">
                                <span class="text-sm text-slate-700">Zemƒõ p≈Øvodu je <strong>vysoce rizikov√°</strong> / Sankce</span>
                            </label>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="isNonFaceToFace" class="form-checkbox h-4 w-4 text-blue-600 rounded">
                                <span class="text-sm text-slate-700">Klient nen√≠ fyzicky p≈ô√≠tomen</span>
                            </label>
                            <div class="border-t border-slate-200 my-2"></div>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="isSuspicious" class="form-checkbox h-4 w-4 text-red-500 rounded">
                                <span class="text-sm text-red-700 font-bold">Podez≈ôen√≠ na nekalou ƒçinnost</span>
                            </label>
                        </fieldset>

                        <button type="submit" id="evaluateBtn" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-4 rounded-lg shadow transition transform active:scale-95">
                            Vyhodnotit Povinnosti
                        </button>
                    </form>
                </div>

                <!-- Results Column -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Default State -->
                    <div id="resultPlaceholder" class="h-full flex flex-col justify-center items-center text-slate-400 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200 p-8">
                        <div class="text-4xl mb-3">‚öñÔ∏è</div>
                        <p>Zvolte typ slu≈æby a parametry pro anal√Ωzu povinnost√≠ dle metodiky ƒåAK.</p>
                    </div>

                    <!-- Active Results (Hidden by default) -->
                    <div id="resultPanel" class="hidden space-y-4" aria-live="polite">
                        <!-- Main Status Banner -->
                        <div id="statusBanner" class="p-4 rounded-lg border-l-8 shadow-sm flex items-start" role="status" aria-live="polite" aria-atomic="true">
                            <!-- JS Populated -->
                        </div>

                        <!-- Exempt Info (Only shown if service is exempt) -->
                        <div id="exemptInfo" class="hidden bg-green-50 p-6 rounded-lg border border-green-200">
                            <h3 class="font-bold text-green-900 mb-2">V√Ωjimka z AML povinnost√≠</h3>
                            <p class="text-green-800 text-sm">
                                U zvolen√©ho typu pr√°vn√≠ slu≈æby (Obhajoba nebo Bƒõ≈æn√© poradenstv√≠ bez spr√°vy majetku) se advok√°t nest√°v√° povinnou osobou ve smyslu z√°kona ƒç. 253/2008 Sb.
                                <br><br>
                                <strong>Plat√≠ povinnost mlƒçenlivosti.</strong> Klienta nen√≠ t≈ôeba lustrovat v sankƒçn√≠ch seznamech ani zji≈°≈•ovat p≈Øvod majetku, pokud se povaha slu≈æby nezmƒõn√≠ na sledovanou ƒçinnost.
                            </p>
                        </div>

                        <!-- Obligations Grid (Shown only if NOT exempt) -->
                        <div id="obligationsGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Identifikace Card -->
                            <div class="bg-white p-5 rounded-lg border border-slate-200 shadow-sm relative">
                                <div class="absolute top-0 right-0 bg-slate-100 text-slate-500 text-xs px-2 py-1 rounded-bl">Krok 1</div>
                                <h3 class="font-bold text-slate-800 border-b pb-2 mb-3 flex justify-between items-center">
                                    <span>Identifikace</span>
                                    <span id="idStatusBadge" class="text-xs px-2 py-1 rounded-full bg-gray-200 text-gray-700">---</span>
                                </h3>
                                <ul id="idSteps" class="text-sm text-slate-600 space-y-2 list-disc list-inside">
                                    <!-- JS Populated -->
                                </ul>
                            </div>

                            <!-- Kontrola Card -->
                            <div class="bg-white p-5 rounded-lg border border-slate-200 shadow-sm relative">
                                <div class="absolute top-0 right-0 bg-slate-100 text-slate-500 text-xs px-2 py-1 rounded-bl">Krok 2</div>
                                <h3 class="font-bold text-slate-800 border-b pb-2 mb-3 flex justify-between items-center">
                                    <span>Kontrola Klienta</span>
                                    <span id="controlStatusBadge" class="text-xs px-2 py-1 rounded-full bg-gray-200 text-gray-700">---</span>
                                </h3>
                                <div id="controlContent" class="text-sm text-slate-600">
                                    <!-- JS Populated -->
                                </div>
                            </div>
                        </div>

                        <!-- Specific Warnings -->
                        <div id="warningContainer" class="hidden bg-amber-50 border border-amber-200 text-amber-900 p-4 rounded-lg text-sm shadow-sm">
                            <h4 class="font-bold mb-1 flex items-center">‚ö†Ô∏è D≈Øle≈æit√° upozornƒõn√≠ (Metodika 2025)</h4>
                            <div id="warningText" class="space-y-1"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB 4: Rizikov√© Faktory -->
        <section id="tab-rizika" class="hidden space-y-8 animate-fade-in" tabindex="-1">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h2 class="text-2xl font-bold text-slate-800 mb-4">Hodnocen√≠ rizik a nov√© hrozby</h2>
                <p class="text-slate-600 mb-6">
                    Kromƒõ klasick√Ωch rizik (hotovost, netransparentn√≠ vlastnictv√≠) klade metodika 2025 d≈Øraz na mezin√°rodn√≠ sankce a virtu√°ln√≠ aktiva.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="p-4 border rounded-lg bg-red-50 border-red-100">
                        <h3 class="font-bold text-red-800 mb-2">üö´ Mezin√°rodn√≠ Sankce</h3>
                        <p class="text-sm text-slate-700 mb-2">Povinnost kontrolovat sankƒçn√≠ seznamy (EU, OSN, n√°rodn√≠) u ka≈æd√©ho klienta u sledovan√© ƒçinnosti.</p>
                        <p class="text-xs text-slate-500">Pozor na tzv. "obch√°zen√≠ sankc√≠" p≈ôes slo≈æit√© struktury.</p>
                    </div>

                    <div class="p-4 border rounded-lg bg-orange-50 border-orange-100">
                        <h3 class="font-bold text-orange-800 mb-2">‚Çø Virtu√°ln√≠ Aktiva (Krypto)</h3>
                        <p class="text-sm text-slate-700 mb-2">Pokud je zdrojem majetku kryptomƒõna, jedn√° se automaticky o <strong>vy≈°≈°√≠ riziko</strong>.</p>
                        <p class="text-xs text-slate-500">Nutn√© vy≈æadovat dolo≈æen√≠ historie transakc√≠ (blockchain anal√Ωza).</p>
                    </div>

                    <div class="p-4 border rounded-lg bg-blue-50 border-blue-100">
                        <h3 class="font-bold text-blue-800 mb-2">üè¢ Slo≈æit√© struktury</h3>
                        <p class="text-sm text-slate-700 mb-2">Klient vyu≈æ√≠v√° "Shell companies" nebo trusty v jurisdikc√≠ch, kter√© nespolupracuj√≠ s EU.</p>
                        <p class="text-xs text-slate-500">Pokud nelze rozkl√≠ƒçovat UBO, obchod se mus√≠ odm√≠tnout.</p>
                    </div>

                </div>
            </div>
        </section>

        <!-- TAB 5: Modelov√© Situace -->
        <section id="tab-situace" class="hidden space-y-8 animate-fade-in" tabindex="-1">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h2 class="text-2xl font-bold text-slate-800 mb-6">Modelov√© situace</h2>

                <div class="space-y-4">
                    <!-- Scenario 1 -->
                    <div class="border border-slate-200 rounded-lg overflow-hidden">
                        <div class="bg-slate-50 p-4 font-semibold text-slate-800 flex justify-between items-center scenario-toggle scenario-header" data-target="scen1" role="button" tabindex="0" aria-expanded="false">
                            <span>1. Klient se svƒõ≈ô√≠, ≈æe pen√≠ze na n√°kup nemovitosti poch√°z√≠ z da≈àov√©ho √∫niku.</span>
                            <span class="text-blue-600 text-sm">≈òe≈°en√≠</span>
                        </div>
                        <div id="scen1" class="hidden p-4 bg-white border-t border-slate-200" aria-hidden="true">
                            <p class="mb-2 text-slate-700">
                                <strong class="text-red-600">POVINNOST OZN√ÅMIT (OPO)</strong>
                            </p>
                            <p class="text-sm text-slate-600">
                                Jde o n√°kup nemovitosti (Sledovan√° ƒçinnost). Informace o p≈Øvodu penƒõz z trestn√© ƒçinnosti (da≈àov√Ω √∫nik) zakl√°d√° podez≈ôen√≠. Advok√°t mus√≠ podat Ozn√°men√≠ podez≈ôel√©ho obchodu (OPO) ƒåesk√© advok√°tn√≠ komo≈ôe. Mlƒçenlivost je prolomena ¬ß 21 AML z√°kona u sledovan√Ωch ƒçinnost√≠.
                            </p>
                        </div>
                    </div>

                    <!-- Scenario 2 -->
                    <div class="border border-slate-200 rounded-lg overflow-hidden">
                        <div class="bg-slate-50 p-4 font-semibold text-slate-800 flex justify-between items-center scenario-toggle scenario-header" data-target="scen2" role="button" tabindex="0" aria-expanded="false">
                            <span>2. Obh√°jce zjist√≠, ≈æe klient plat√≠ za obhajobu z v√Ωnos≈Ø trestn√© ƒçinnosti.</span>
                            <span class="text-blue-600 text-sm">≈òe≈°en√≠</span>
                        </div>
                        <div id="scen2" class="hidden p-4 bg-white border-t border-slate-200" aria-hidden="true">
                            <p class="mb-2 text-slate-700">
                                <strong class="text-green-600">MLƒåENLIVOST (≈Ω√°dn√© hl√°≈°en√≠)</strong>
                            </p>
                            <p class="text-sm text-slate-600">
                                I kdy≈æ advok√°t v√≠ o p≈Øvodu penƒõz, jde o odmƒõnu za <strong>obhajobu</strong>. Obhajoba nen√≠ sledovanou ƒçinnost√≠. Uplatn√≠ se absolutn√≠ povinnost mlƒçenlivosti. Advok√°t pen√≠ze p≈ôijme (pokud nejde o hotovost nad limit), OPO nepod√°v√°.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 py-8 mt-auto" role="contentinfo">
        <div class="container mx-auto px-4 text-center text-xs">
            <p class="mb-2">Vytvo≈ôeno v souladu s Metodikou ƒåAK pro plnƒõn√≠ povinnost√≠ dle z√°kona ƒç. 253/2008 Sb. (verze 01/2025).</p>
            <p class="opacity-70">Aplikace nenahrazuje pr√°vn√≠ posouzen√≠ konkr√©tn√≠ho p≈ô√≠padu.</p>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // Utility: safe number formatter for EUR (Czech locale)
        function formatEUR(value) {
            try {
                return new Intl.NumberFormat('cs-CZ', { style: 'currency', currency: 'EUR', maximumFractionDigits: 2 }).format(value);
            } catch (e) {
                return value + ' EUR';
            }
        }

        // --- 1. Navigation Logic with ARIA updates ---
        function switchTab(tabId) {
            document.querySelectorAll('main > section').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById(tabId);
            if (!target) return;
            target.classList.remove('hidden');
            target.focus({ preventScroll: true });

            // Update tab buttons state and ARIA
            document.querySelectorAll('nav [role="tab"]').forEach(btn => {
                const controls = btn.getAttribute('aria-controls');
                const isActive = controls === tabId;
                btn.classList.toggle('tab-active', isActive);
                btn.classList.toggle('tab-inactive', !isActive);
                btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
            });

            // Resize chart if visible and instance exists
            if (tabId === 'tab-limity' && window.limitsChartInstance && typeof window.limitsChartInstance.resize === 'function') {
                window.limitsChartInstance.resize();
            }
        }

        // --- 2. Chart.js (Financial Limits) SAFE initialization ---
        function initLimitsChart() {
            const canvas = document.getElementById('limitsChart');
            if (!canvas) return;
            const ctx = canvas.getContext && canvas.getContext('2d');
            if (!ctx) return;

            // Create only once
            if (window.limitsChartInstance) {
                try { window.limitsChartInstance.update(); } catch(e) {}
                return;
            }

            window.limitsChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['P≈ô√≠le≈æitostn√Ω obchod (ID)', 'Advok√°tn√≠ √öschova (ID)', 'Povinn√° Kontrola', 'Limit Hotovosti'],
                    datasets: [{
                        label: 'Limit v EUR (orientaƒçn√≠)',
                        data: [1000, 0, 15000, 10800],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.6)',
                            'rgba(220, 38, 38, 0.7)',
                            'rgba(79, 70, 229, 0.6)',
                            'rgba(245, 158, 11, 0.6)'
                        ],
                        borderColor: [
                            'rgb(59, 130, 246)',
                            'rgb(220, 38, 38)',
                            'rgb(79, 70, 229)',
                            'rgb(245, 158, 11)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'ƒå√°stka (EUR)' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const y = context.parsed?.y ?? context.parsed ?? 0;
                                    if (String(context.label || '').includes('√öschova')) return "V≈ædy (0 EUR limit)";
                                    return formatEUR(y);
                                }
                            }
                        },
                        legend: { display: false }
                    }
                }
            });
        }

        // Initialize chart when DOM is ready and Chart.js loaded
        document.addEventListener('DOMContentLoaded', function () {
            // Try to initialize chart safely; Chart.js is deferred so it should be available now
            if (typeof Chart !== 'undefined') {
                initLimitsChart();
            } else {
                // If Chart not available yet, retry shortly
                const tries = 5;
                let attempt = 0;
                const t = setInterval(() => {
                    attempt++;
                    if (typeof Chart !== 'undefined') {
                        initLimitsChart();
                        clearInterval(t);
                    } else if (attempt >= tries) {
                        clearInterval(t);
                    }
                }, 200);
            }

            // Scenario toggle: add keyboard handlers for accessibility
            document.querySelectorAll('.scenario-header').forEach(header => {
                header.addEventListener('keydown', (ev) => {
                    if (ev.key === 'Enter' || ev.key === ' ') {
                        ev.preventDefault();
                        const target = header.getAttribute('data-target');
                        toggleScenario(target);
                    }
                });
            });

            // Also ensure clickable scenario headers have proper click listeners
            document.querySelectorAll('.scenario-header').forEach(header => {
                header.addEventListener('click', () => {
                    const target = header.getAttribute('data-target');
                    toggleScenario(target);
                });
            });

            // Basic inline validation for tradeValue input on blur
            const tradeInput = document.getElementById('tradeValue');
            if (tradeInput) {
                tradeInput.addEventListener('blur', () => {
                    validateTradeValue();
                });
            }
        });

        // --- 3. Scenario Toggle (with ARIA) ---
        function toggleScenario(id) {
            const el = document.getElementById(id);
            const header = document.querySelector(`[data-target="${id}"]`);
            if (!el || !header) return;
            const isHidden = el.classList.contains('hidden');
            el.classList.toggle('hidden', !isHidden);
            el.setAttribute('aria-hidden', String(!isHidden));
            header.setAttribute('aria-expanded', String(isHidden));
        }

        // --- 4. FORM: Basic validation & UX helpers ---
        function validateTradeValue() {
            const input = document.getElementById('tradeValue');
            const errorEl = document.getElementById('tradeValueError');
            if (!input || !errorEl) return true;
            const v = parseFloat(input.value);
            if (isNaN(v)) {
                errorEl.style.display = 'none';
                errorEl.textContent = '';
                return true; // empty allowed; logic will treat as 0
            }
            if (v < 0) {
                errorEl.style.display = '';
                errorEl.textContent = 'Nelze zadat z√°pornou hodnotu.';
                return false;
            }
            // optional: enforce a practical maximum (e.g., 1e9 EUR)
            if (v > 1e9) {
                errorEl.style.display = '';
                errorEl.textContent = 'Zadan√° hodnota se zd√° p≈ô√≠li≈° vysok√°; ovƒõ≈ôte pros√≠m.';
                return false;
            }
            errorEl.style.display = 'none';
            errorEl.textContent = '';
            return true;
        }

        // --- 5. CORE LOGIC: AML Wizard 2025 (improved & safer) ---
        function calculateObligations() {
            // Validate input first
            if (!validateTradeValue()) {
                document.getElementById('tradeValue').focus();
                return;
            }

            // Inputs
            const serviceType = (document.getElementById('serviceType') || {}).value || '';
            const value = parseFloat(document.getElementById('tradeValue').value) || 0;
            const clientType = (document.getElementById('clientType') || {}).value || 'fyzicka';
            const isPEP = !!document.getElementById('isPEP')?.checked;
            const isHighRiskCountry = !!document.getElementById('isHighRiskCountry')?.checked;
            const isNonFaceToFace = !!document.getElementById('isNonFaceToFace')?.checked;
            const isSuspicious = !!document.getElementById('isSuspicious')?.checked;

            // UI Elements
            const resultPanel = document.getElementById('resultPanel');
            const resultPlaceholder = document.getElementById('resultPlaceholder');
            const exemptInfo = document.getElementById('exemptInfo');
            const obligationsGrid = document.getElementById('obligationsGrid');
            const banner = document.getElementById('statusBanner');
            const idBadge = document.getElementById('idStatusBadge');
            const idSteps = document.getElementById('idSteps');
            const ctrlBadge = document.getElementById('controlStatusBadge');
            const ctrlContent = document.getElementById('controlContent');
            const warnCont = document.getElementById('warningContainer');
            const warningText = document.getElementById('warningText');

            resultPlaceholder.classList.add('hidden');
            resultPanel.classList.remove('hidden');
            let warnings = [];

            // --- STEP A: Determine if AML applies (Service Type) ---
            const isMonitoredActivity = ['uschova', 'nemovitost', 'korporace', 'majatek'].includes(serviceType);
            const isCustody = serviceType === 'uschova';

            // If non-monitored AND not suspicious -> exempt
            if (!isMonitoredActivity && !isSuspicious) {
                banner.className = "p-4 rounded-lg border-l-8 shadow-sm flex items-center bg-green-100 border-green-500 text-green-900";
                banner.innerHTML = `<span class="text-2xl mr-3">üõ°Ô∏è</span> <div><h3 class="font-bold text-lg">V√Ωjimka (Nesledovan√° ƒçinnost)</h3><p class="mt-1 text-sm">U t√©to ƒçinnosti se AML bƒõ≈ænƒõ neuplatn√≠ (mlƒçenlivost z≈Øst√°v√°).</p></div>`;
                exemptInfo.classList.remove('hidden');
                obligationsGrid.classList.add('hidden');
                warnCont.classList.add('hidden');
                return;
            }

            // If we are here, it IS a Monitored Activity OR it's Suspicious
            exemptInfo.classList.add('hidden');
            obligationsGrid.classList.remove('hidden');

            let controlRequired = false;
            let controlType = "Standardn√≠";
            let statusColor = "bg-blue-50 border-blue-500 text-blue-900";
            let statusText = "Standardn√≠ postup";

            // --- STEP B: Identification Logic ---
            let identificationRequired = false;

            if (isCustody) {
                identificationRequired = true;
                warnings.push("Advok√°tn√≠ √∫schova vy≈æaduje identifikaci V≈ΩDY (bez ohledu na limit).");
            } else if (value >= 1000) {
                identificationRequired = true;
            } else if (isSuspicious) {
                identificationRequired = true;
                warnings.push("Podez≈ôel√Ω obchod vy≈æaduje identifikaci v≈ædy.");
            }

            if (identificationRequired) {
                idBadge.textContent = "NUTN√Å";
                idBadge.className = "text-xs px-2 py-1 rounded-full bg-red-100 text-red-700 font-bold";
                let steps = `<li>Zaznamenat identifikaƒçn√≠ √∫daje (dle ¬ß 5).</li>`;
                if (isNonFaceToFace) steps += `<li class="text-blue-700 font-semibold">Postup na d√°lku (¬ß 11) - ovƒõ≈ôte p≈ôijateln√© d√°lkov√© ovƒõ≈ôen√≠ nebo autentizaƒçn√≠ metody.</li>`;
                steps += `<li>Ovƒõ≈ôen√≠, zda klient nen√≠ na sankƒçn√≠m seznamu (EU/OSN/n√°rodn√≠).</li>`;
                idSteps.innerHTML = steps;
            } else {
                idBadge.textContent = "Nen√≠ nutn√°";
                idBadge.className = "text-xs px-2 py-1 rounded-full bg-green-100 text-green-700";
                idSteps.innerHTML = "<li>Podlimitn√≠ obchod mimo √∫schovu - identifikace nen√≠ standardnƒõ po≈æadov√°na.</li>";
            }

            // --- STEP C: Control Logic ---
            // Trigger thresholds
            if (value >= 15000 || isCustody || isSuspicious || isPEP || isHighRiskCountry || clientType === 'sverensky') {
                controlRequired = true;
            }

            // Determine Level of Control
            if (isPEP || isHighRiskCountry || isSuspicious || (isNonFaceToFace && !identificationRequired)) {
                controlType = "Zes√≠len√° (EDD)";
                statusColor = "bg-red-100 border-red-500 text-red-900";
                statusText = "VYSOK√â RIZIKO - Zes√≠len√° kontrola";

                if (isPEP) warnings.push("PEP: Nutn√Ω souhlas statut√°rn√≠ho org√°nu/partnera kancel√°≈ôe k obchodu a dokumentace dodateƒçn√Ωch opat≈ôen√≠.");
                if (isHighRiskCountry) warnings.push("Zemƒõ p≈Øvodu klasifikovan√° jako vysok√© riziko: zv√Ω≈°en√Ω monitoring a dolo≈æen√≠ p≈Øvodu prost≈ôedk≈Ø.");
            } else if (controlRequired) {
                statusColor = "bg-yellow-100 border-yellow-500 text-yellow-900";
                statusText = "ST≈òEDN√ç RIZIKO - Povinn√° kontrola";
            } else {
                statusText = "N√çZK√â RIZIKO - Bez kontroly";
            }

            // Suspicious Override
            if (isSuspicious) {
                statusColor = "bg-red-200 border-red-700 text-red-900";
                statusText = "üõë PODEZ≈òEN√ç NA OPO";
                warnings.push("Zva≈æte pod√°n√≠ OPO Komo≈ôe. Nevarujte klienta (tipping-off)!");
            }

            // Render Control
            if (controlRequired) {
                ctrlBadge.textContent = controlType.toUpperCase();
                ctrlBadge.className = controlType.includes('Zes√≠len√°') 
                    ? "text-xs px-2 py-1 rounded-full bg-red-100 text-red-700 font-bold"
                    : "text-xs px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 font-bold";

                let ctrlHtml = `<ul class="list-disc list-inside space-y-1 mb-2">`;
                ctrlHtml += `<li>Zjistit skuteƒçn√©ho majitele (UBO) a ovƒõ≈ôit vlastnickou strukturu.</li>`;
                ctrlHtml += `<li>Ovƒõ≈ôit √∫ƒçel a povahu obchodu.</li>`;
                ctrlHtml += `<li>Provƒõ≈ôit zdroje majetku a platebn√≠ historii.</li>`;
                if (controlType.includes('Zes√≠len√°')) {
                    ctrlHtml += `<li class="font-bold text-red-600">Dolo≈æen√≠ p≈Øvodu majetku dokumenty (bankovn√≠ v√Ωpisy, smlouvy, blockchain evidence apod.).</li>`;
                }
                ctrlHtml += `</ul>`;
                ctrlContent.innerHTML = ctrlHtml;
            } else {
                ctrlBadge.textContent = "Nen√≠ nutn√°";
                ctrlBadge.className = "text-xs px-2 py-1 rounded-full bg-green-100 text-green-700";
                ctrlContent.innerHTML = "<p>Pod hranic√≠ pro kontrolu.</p>";
            }

            // Final Render
            banner.className = `p-4 rounded-lg border-l-8 shadow-sm flex items-center ${statusColor}`;
            banner.innerHTML = `<span class="text-2xl mr-3">${isSuspicious ? 'üõë' : '‚ÑπÔ∏è'}</span> <div><h3 class="font-bold text-lg">${statusText}</h3><p class="mt-1 text-sm text-slate-700">Hodnocen√≠ na z√°kladƒõ zadan√Ωch parametr≈Ø. Hodnota: ${formatEUR(value)}</p></div>`;

            if (warnings.length > 0) {
                warnCont.classList.remove('hidden');
                // Deduplicate warnings
                const unique = Array.from(new Set(warnings));
                warningText.innerHTML = unique.map(w => `<p>‚Ä¢ ${w}</p>`).join('');
            } else {
                warnCont.classList.add('hidden');
                warningText.innerHTML = '';
            }
        }
    </script>
</body>
</html>
